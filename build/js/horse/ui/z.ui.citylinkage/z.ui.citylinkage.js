define(["citydata"],function(t){var e=t,i={cityItemsKey:{provincesLevelId:0,cityLevelId:null,countyLevelId:null},selectedCity:{provinces:{provincesId:null,provincesName:""},city:{cityId:null,cityName:""},county:{countyId:null,countyName:""}}},o=function(){this.defaultParams={contentId:""},this.options={}};return o.prototype={constructor:o,init:function(t){this.options=Horse.util.coverObject(this.defaultParams,t),this._init()},_init:function(){this.registerContentClick(),this.registerDocumentClick()},registerContentClick:function(){var t=this.options.contentId;$("#"+t).addClass("citylinkage-area");var e=Horse.util.delegate(this._handlerContentClick,this,[{contentId:t}]);$("#"+t).click(e)},registerDocumentClick:function(){var t=this.options;$(document).click(function(e){Horse.util.delegate(o.prototype._handleDocumentClick,this,[{event:e,options:t}])()})},registerProvincestabClick:function(){var t=this.options.contentId,e=Horse.util.delegate(this._handlerProvincestabClick,this,[{contentId:t}]);$("#provincestab_"+t).click(e)},registerCitytabClick:function(){var t=this.options.contentId,e=Horse.util.delegate(this._handlerCitytabClick,this,[{contentId:t}]);$("#citytab_"+t).click(e)},registerCountytabClick:function(){var t=this.options.contentId,e=Horse.util.delegate(this._handlerCountytabClick,this,[{contentId:t}]);$("#countytab_"+t).click(e)},registertabbodydetailInfoClick:function(){var t=this.options.contentId,e=this;$(".tab-body-detailInfo").click(function(i){i.stopPropagation();var o=$(this).attr("attrId"),n=$(this).attr("attrItem");Horse.util.delegate(e._handlertabbodydetailInfoClick,e,[{contentId:t,attrId:o,attrItem:n}])()})},_handlerContentClick:function(){var t=this.options.contentId;if(!($("#citylinkageTab").length>0)){var e="<div class='tab-citylinkage' id='citylinkageTab'>";e+="       <div class='tab-head'>",e+="           <div id='provincestab_"+t+"' class='tab-head-name tab-head-borderbottom-none'>省份</div>",e+="           <div id='citytab_"+t+"' class='tab-head-name2 tab-head-borderbottom'>城市</div>",e+="           <div id='countytab_"+t+"' class='tab-head-name tab-head-borderbottom'>县区</div>",e+="       </div>",e+="       <div id='detailInfo_"+t+"' class='tab-body'>",e+="       </div>",e+="   </div>",$("body").append(e),this.getPosition(),this.getCityLevelInfo(i.cityItemsKey.provincesLevelId),this.registerProvincestabClick(),this.registerCitytabClick(),this.registerCountytabClick()}},_handleDocumentClick:function(t){for(var e=t.event||window.event,i=e.srcElement||e.target;i;){if("citylinkageTab"==i.id||i.id==t.options.contentId)return;i=i.parentNode}$("#citylinkageTab").length>0&&$("#citylinkageTab").remove()},_handlerProvincestabClick:function(t){this.setProvincestabStyle(t),this.getCityLevelInfo(i.cityItemsKey.provincesLevelId)},_handlerCitytabClick:function(t){this.setCitytabStyle(t),this.getCityLevelInfo(i.cityItemsKey.cityLevelId)},_handlerCountytabClick:function(t){this.setCountytabStyle(t),this.getCityLevelInfo(i.cityItemsKey.countyLevelId)},_handlertabbodydetailInfoClick:function(t){var n,a=t.contentId,c=t.attrId,s=t.attrItem;if($.each(e,function(t,e){var i=t.split(","),o=i.length;return $.trim(t)==c||$.trim(i[o-1])!=c||(n=t,!1)}),null==n)return i.selectedCity.county.countyId=c,i.selectedCity.county.countyName=s,this.showSelectedCityInfo(a),$("span.tab-body-detailInfo").removeClass("selectedStyle"),void $("span.tab-body-detailInfo[attrId='"+c+"']").addClass("selectedStyle");var d=n.split(",").length;2==d?(o.prototype.setCitytabStyle(t),i.cityItemsKey.cityLevelId=n,i.cityItemsKey.countyLevelId=null,i.selectedCity.provinces.provincesId=c,i.selectedCity.city.cityId=null,i.selectedCity.county.countyId=null,i.selectedCity.provinces.provincesName=s,i.selectedCity.city.cityName="",i.selectedCity.county.countyName=""):3==d&&(o.prototype.setCountytabStyle(t),i.cityItemsKey.countyLevelId=n,i.selectedCity.city.cityId=c,i.selectedCity.county.countyId=null,i.selectedCity.city.cityName=s,i.selectedCity.county.countyName=""),this.showSelectedCityInfo(a),this.getCityLevelInfo(n),this.registertabbodydetailInfoClick()},setProvincestabStyle:function(t){var e=t.contentId;$("#provincestab_"+e).removeClass("tab-head-borderbottom").addClass("tab-head-borderbottom-none"),$("#citytab_"+e).removeClass("tab-head-borderbottom-none").addClass("tab-head-borderbottom"),$("#countytab_"+e).removeClass("tab-head-borderbottom-none").addClass("tab-head-borderbottom")},setCitytabStyle:function(t){var e=t.contentId;$("#provincestab_"+e).removeClass("tab-head-borderbottom-none").addClass("tab-head-borderbottom"),$("#citytab_"+e).removeClass("tab-head-borderbottom").addClass("tab-head-borderbottom-none"),$("#countytab_"+e).removeClass("tab-head-borderbottom-none").addClass("tab-head-borderbottom")},setCountytabStyle:function(t){var e=t.contentId;$("#provincestab_"+e).removeClass("tab-head-borderbottom-none").addClass("tab-head-borderbottom"),$("#citytab_"+e).removeClass("tab-head-borderbottom-none").addClass("tab-head-borderbottom"),$("#countytab_"+e).removeClass("tab-head-borderbottom").addClass("tab-head-borderbottom-none")},getCityLevelInfo:function(t){var o=this.options.contentId;if(null==t)return void $("#detailInfo_"+o).html("");var n="";$.each(e[t],function(t,e){var o="";t!=i.selectedCity.provinces.provincesId&&t!=i.selectedCity.city.cityId&&t!=i.selectedCity.county.countyId||(o="selectedStyle"),n+="<span class='tab-body-detailInfo "+o+"' id='c_"+t+"' attrId='"+t+"' attrItem='"+e+"'>"+e+"</span>"}),$("#detailInfo_"+o).html(n),this.registertabbodydetailInfoClick()},showSelectedCityInfo:function(t){var e=(""==i.selectedCity.provinces.provincesName?"":i.selectedCity.provinces.provincesName+" / ")+(""==i.selectedCity.city.cityName?"":i.selectedCity.city.cityName+" / ")+(""==i.selectedCity.county.countyName?"":i.selectedCity.county.countyName);$("#"+t).html(e)},getPosition:function(){var t=$("#"+this.options.contentId).offset().left,e=$("#"+this.options.contentId).offset().top+$("#"+this.options.contentId).height();$("#citylinkageTab").css("left",t),$("#citylinkageTab").css("top",e)}},o});