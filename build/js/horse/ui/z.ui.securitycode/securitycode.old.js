define(["validate","text!SecurityCodeTeml","commonOp"],function(validate,template,commonOp){var securityCodePlugIn=function(){this.defaultParams={containerId:"",securityCodePlugInAreaId:"",fillInCompleteCallBack:null,needConfirmPassword:{referencePasswordId:"",callback:null}}};return securityCodePlugIn.prototype={constructor:securityCodePlugIn,init:function(t){this.options=commonOp.coverObject(this.defaultParams,t),this._init()},_init:function(){this.renderTempl()},renderTempl:function(){var containerId=this.options.containerId,securityCodePlugInAreaId=this.options.securityCodePlugInAreaId,tplFun=_.template(template),tpl=tplFun({SecurityCodePlugInAreaId:securityCodePlugInAreaId}),t=this;$("#"+containerId).html(tpl),this.getElements(),eval('var events = {"keyup #'+securityCodePlugInAreaId+'>input[type=password]": "txtSecurityCodeKeyup","keydown #'+securityCodePlugInAreaId+'>input[type=password]": "txtSecurityCodeKeydown","focus #'+securityCodePlugInAreaId+'>input[type=password]": "txtSecurityCodeFocus"};');for(var e in events){var typeTarget=e.split(" ");if(typeTarget&&2==typeTarget.length){var type=typeTarget[0],target=typeTarget[1];$("#"+containerId).find(target).on(type,$.proxy(t[events[e]],this))}}},getElements:function(){var t=this.options.securityCodePlugInAreaId;this.txtSecurityCode_Input=$("#"+t).find("input[type=password]")},txtSecurityCodeKeyup:function(t){this.txtSecurityCodeKeyupHandler(t)},txtSecurityCodeKeydown:function(t){this.txtSecurityCodeKeydownHandler(t)},txtSecurityCodeFocus:function(t){this.txtSecurityCodeFocusHandler(t)},txtSecurityCodeKeyupHandler:function(t){var e=$(t.currentTarget),n=e.next("input[type=password]"),r=parseInt(e.attr("index")),i=e.val();if(validate.NumCheckByLength(1,i)?n.length>0&&(this.txtSecurityCode_Input.removeClass("current"),n.focus(),n.addClass("current")):e.val(""),5==r){var a="";if(this.txtSecurityCode_Input.each(function(t,e){a+=$(e).val()}),a=a.trim(),validate.IsFunction(this.options.fillInCompleteCallBack)&&6==a.length&&this.options.fillInCompleteCallBack(a),!validate.IsNull(this.options.needConfirmPassword.referencePasswordId)){var o="";if($("#"+this.options.needConfirmPassword.referencePasswordId).find("input[type=password]").each(function(t,e){o+=$(e).val()}),o=o.trim(),6==o.length&&6==a.length&&o==a)return void(validate.IsFunction(this.options.needConfirmPassword.callback)&&this.options.needConfirmPassword.callback(!0,o));validate.IsFunction(this.options.needConfirmPassword.callback)&&this.options.needConfirmPassword.callback(!1)}}},txtSecurityCodeKeydownHandler:function(t){var e=$(t.currentTarget),n=parseInt(e.attr("index")),r=e.val(),i=e.prev("input[type=password]");8==(window.event||arguments.callee.caller.arguments[0]).keyCode&&(5==n&&validate.IsNull(r)&&(i.val(""),i.focus(),this.txtSecurityCode_Input.removeClass("current"),i.addClass("current")),5!=n&&(i.val(""),i.focus(),this.txtSecurityCode_Input.removeClass("current"),i.addClass("current")))},txtSecurityCodeFocusHandler:function(t){var e=$(t.currentTarget),n=e.val(),r=parseInt(e.attr("index")),i=!1;if(this.txtSecurityCode_Input.each(function(t,e){var a=$(e).val();return validate.IsNull(a)&&0==t&&0==r?(i=!0,!1):!validate.IsNull(a)&&validate.IsNull(n)&&t==r-1?(i=!0,!1):!(!validate.IsNull(n)&&5==r)||(i=!0,!1)}),!i)return void e.blur()}},securityCodePlugIn});